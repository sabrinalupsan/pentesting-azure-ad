### Connect
> $passwd = ConvertTo-SecureString "\<password>" -AsPlainText -Force

> $creds = New-Object System.Management.Automation.PSCredential
("\<username>@\<domain name>.onmicrosoft.com"
, $passwd) 

> Connect-AzAccount -Credential $creds

### Get all App services
>Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}

Get function apps 
>Get-AzFunctionApp

Get all storage accounts
>Get-AzStorageAccount | fl

AAD users
> Get-AzADUser

### Others
> Get-AzResource

To get commands for VMs (replace for other resources)
> Get-Command -Noun *vm* -Verb Get

Get info about current context
>Get-AzContext

List all available contexts
>Get-AzContext -ListAvailable

Enumerate subscriptions accessible by the current user
>Get-AzSubscription

Enumerate all resources visible to the current user
>Get-AzResource

Enumerate all Azure RBAC role assignments
>Get-AzRoleAssignment

Enumerate a specific user
>Get-AzADUser -UserPrincipalName \<username>@\<domain name>.onmicrosoft.com 

Search for a user based on string in first characters of DisplayName
> Get-AzADUser -SearchString "admin" 

Search for users who contain the word "admin" in their Display name:
> Get-AzADUser |?{$_.Displayname -match "admin"} 

### AAD Groups
List all groups
>Get-AzADGroup

Get-AzADGroup
> Get-AzADGroup -ObjectId \<objectID> 

Search for a group based on string in first characters of DisplayName
> Get-AzADGroup -SearchString "admin" | fl * 

To search for groups which contain the word "admin" in their name:
> Get-AzADGroup |?{$_.Displayname -match "admin"} 

Get members of a group
> Get-AzADGroupMember -ObjectId \<objectID>

### AAD Apps 
Get all the application objects registered with the current tenant
> Get-AzADApplication

Get all details about an application
> Get-AzADApplication -ObjectId \<objectID>

Get an application based on the display name
> Get-AzADApplication | ?{$_.DisplayName -match "app"} 

Get apps that have passwords set (can't get password)
> Get-AzADApplication | %{if(Get-AzADAppCredential -ObjectID
\$\_.ObjectID){$_}}

### AAD Service Principals
Get all service principals
> Get-AzADServicePrincipal

Get all details about a service principal
> Get-AzADServicePrincipal -ObjectId \<objectID>

Get a service principal based on the display name
> Get-AzADServicePrincipal | ?{$_.DisplayName -match "app"}

### Key vaults
List all key vaults
>Get-AzKeyVault

Get info about a specific vault
>Get-AzKeyVault -VaultName \<vault name>

List saved creds
> Get-AzKeyVaultSecret -VaultName \<vault name> -AsPlainText

Read saved creds
> Get-AzKeyVaultSecret -VaultName \<vault name> -Name <secret name> -AsPlainText

### Access token
Request access token for ARM
> Get-AzAccessToken

>(Get-AzAccessToken).Token

Request access token for AAD Graph
> Get-AzAccessToken -ResourceTypeName MSGraph

>(Get-AzAccessToken -ResourceTypeName MSGraph).Token

For older versions of Az PS
> (Get-AzAccessToken -Resource "https://graph.microsoft.com").Token 

Connect using the token
ARM token
> Connect-AzAccount -AccountId \<username>@\<domain name>.onmicrosoft.com -AccessToken $token

MS Graph token
> Connect-AzAccount -AccountId \<username>@\<domain name>.onmicrosoft.com -AccessToken $token -MicrosoftGraphAccessToken $graphtoken

### Read resource group deployment history
>Get-AzResourceGroup

>Get-AzResourceGroupDeployment -ResourceGroupName \<resource group name>

Save the deployment locally
>Save-AzResourceGroupDeploymentTemplate -ResourceGroupName \<resource group name> -DeploymentName \<deployment name>

### Other notes
Az PowerShell stores access tokens in clear text in C:\Users\[username]\.Azure\TokenCache.dat

It also stores ServicePrincipalSecret in clear-text in AzureRmContext.json if a service principal was used to authenticate